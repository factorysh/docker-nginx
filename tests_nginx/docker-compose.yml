---

version: '3'
services:
    traefik:
        image: bearstech/traefik-dev:2.0
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
        depends_on:
            - web
        expose:
            - 80

    web:
        image: bearstech/nginx:latest
        volumes:
            - ./index.html:/var/www/html/index.html
            - ./nginx_mirror.conf:/etc/nginx/sites-enabled/mirror
            - ./data/log:/var/log/nginx
        expose:
            - '8000'
        depends_on:
            - mirror
        labels:
            traefik.http.routers.nginxWebRouter.rule: Host(`traefik`, `glasses`)

    mirror:
        image: bearstech/http-mirror

    client:
        image: bearstech/debian:stretch
        volumes:
            - ../bin/goss:/usr/bin/goss
            - ../tests_nginx:/goss
            - ../traefik_hosts:/etc/hosts
            - ./data/log:/data/log
        working_dir: /goss
        depends_on:
            - web
            - traefik
